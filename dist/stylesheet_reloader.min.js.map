{"version":3,"sources":["stylesheet_reloader.coffee","stylesheet_reloader.js"],"names":["hasProp","hasOwnProperty","window","StyleSheetReloader","options","hotKeyPressed","prepareOptions","hotKey","event","i","key","len","result","split","length","trim","toLowerCase","keyCode","toUpperCase","charCodeAt","document","addEventListener","e","reload","cssUrl","parseJson","defaultOptions","error","json","optionDefaultValue","optionKey","JSON","parse","_error","console","log","call","addParameter","href","hrefLastChar","link","links","replacedLinks","replacedVersion","querySelectorAll","getAttribute","indexOf","substr","Date","now","setAttribute","runByTagParams","results","script","scripts","push","listen","url","period","reloadIfRequired","urlString","lm","urlLastMod","urlLink","getLastModificationTime","setInterval","lastModified","request","XMLHttpRequest","open","send","readyState","getResponseHeader","this"],"mappings":"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","file":"stylesheet_reloader.min.js","sourcesContent":["###*\r\n * StyleSheetReloader v 1.5\r\n * Author: Vlad Tokarev <vlad@tokarev.tk>\r\n###\r\nwindow.StyleSheetReloader = (options)->\r\n\toptions = window.StyleSheetReloader.prepareOptions(options)\r\n\t# Detects if HotKey is pressed\r\n\thotKeyPressed = (hotKey,event)->\r\n\t\thotKey = hotKey.split('+')\r\n\t\tresult = true\r\n\t\tfor key in hotKey\r\n\t\t\tif key.trim().length\r\n\t\t\t\tkey = key.trim().toLowerCase()\r\n\t\t\t\tif key in ['alt','ctrl','shift']\r\n\t\t\t\t\tif !event[key+'Key']\r\n\t\t\t\t\t\treturn false\r\n\t\t\t\telse\r\n\t\t\t\t\tif event.keyCode != key.toUpperCase().charCodeAt(0)\r\n\t\t\t\t\t\treturn false\r\n\t\treturn result\r\n\t# Adds key pressed event listener\r\n\tdocument.addEventListener('keydown', (e)->\r\n\t\tif hotKeyPressed(options.hotKey,e)\r\n\t\t\twindow.StyleSheetReloader.reload(options.cssUrl)\r\n\t)\r\n\r\n# Prepare options\r\nwindow.StyleSheetReloader.prepareOptions = (options=false, parseJson=false)->\r\n\tdefaultOptions = {\r\n\t\tcssUrl: false\r\n\t\t,hotKey: 'alt+r'\r\n\t}\r\n\tif parseJson && options && options.length\r\n\t\ttry\r\n\t\t\tjson = JSON.parse(options)\r\n\t\t\toptions = json\r\n\t\tcatch error\r\n\t\t\tconsole.log(error)\r\n\tif typeof options is 'string'\r\n\t\toptions = {\r\n\t\t\tcssUrl: options\r\n\t\t}\r\n\tif typeof options != 'object'\r\n\t\toptions = {}\r\n\tfor own optionKey,optionDefaultValue of defaultOptions\r\n\t\tif !options[optionKey]\r\n\t\t\toptions[optionKey] = defaultOptions[optionKey]\r\n\tif options.cssUrl && !options.cssUrl.length\r\n\t\toptions.cssUrl = false\r\n\treturn options\r\n\r\n# Changes links href with replacedVersion get parameter\r\nwindow.StyleSheetReloader.reload = (cssUrl=false)->\r\n\treplacedLinks = 0\r\n\tif typeof cssUrl is 'string' && !cssUrl.length\r\n\t\tcssUrl = false\r\n\tlinks = document.querySelectorAll('link[rel=stylesheet][href]')\r\n\tfor link in links\r\n\t\thref = link.getAttribute('href')\r\n\t\tif href && href.length && (!cssUrl || href.indexOf(cssUrl)!=-1)\r\n\t\t\thref = href.split('replacedVersion')[0]\r\n\t\t\threfLastChar = href.substr(href.length-1)\r\n\t\t\tif hrefLastChar=='?' || hrefLastChar=='&'\r\n\t\t\t\thref = href.substr(0,href.length-1)\r\n\t\t\treplacedVersion = Date.now()\r\n\t\t\taddParameter = '?'\r\n\t\t\tif href.indexOf('?')!=-1\r\n\t\t\t\taddParameter = '&'\r\n\t\t\thref+= addParameter + 'replacedVersion=' + replacedVersion\r\n\t\t\tlink.setAttribute('href',href)\r\n\t\t\treplacedLinks++\r\n\treturn replacedLinks\r\n\r\n# Searching for running by tag parameters\r\nwindow.StyleSheetReloader.runByTagParams = ()->\r\n\tscripts = document.querySelectorAll('script[data-stylesheetReloader]')\r\n\tfor script in scripts\r\n\t\toptions = window.StyleSheetReloader.prepareOptions(script.getAttribute('data-stylesheetReloader'),true)\r\n\t\twindow.StyleSheetReloader(options)\r\n\r\n# Running Live Reloading\r\nwindow.StyleSheetReloader.listen = (url=false, period=1000)->\r\n\tif typeof url is 'string' && !url.length\r\n\t\turl = false\r\n\tif !url\r\n\t\turl = {}\r\n\t\tlinks = document.querySelectorAll('link[rel=stylesheet][href]')\r\n\t\tfor link in links\r\n\t\t\thref = link.getAttribute('href')\r\n\t\t\tif href && href.length\r\n\t\t\t\turl[href] = 0\r\n\tif typeof url is 'string'\r\n\t\turlString = url\r\n\t\turl = {}\r\n\t\turl[urlString] = 0\r\n\treloadIfRequired = ()->\r\n\t\tfor own urlLink,urlLastMod of url\r\n\t\t\tlm = window.StyleSheetReloader.getLastModificationTime(urlLink)\r\n\t\t\tif urlLastMod != lm\r\n\t\t\t\turl[urlLink] = lm\r\n\t\t\t\twindow.StyleSheetReloader.reload(urlLink)\r\n\tsetInterval(reloadIfRequired,period)\r\n\treturn period\r\n\r\n# Get modification time response from server\r\nwindow.StyleSheetReloader.getLastModificationTime = (url)->\r\n\trequest = new XMLHttpRequest()\r\n\ttry\r\n\t\trequest.open('HEAD',url, false)\r\n\t\trequest.send(null)\r\n\tcatch error\r\n\t\tconsole.log(error)\r\n\t\treturn false\r\n\tif request.readyState<3\r\n\t\tconsole.log(\"Server doesn't ready to answer\")\r\n\t\treturn false\r\n\tif !request\r\n\t\tconsole.log(\"XMLHttpRequest doesn't supported by your browser\")\r\n\t\treturn false\r\n\tlastModified = request.getResponseHeader('Last-Modified')\r\n\tif !lastModified\r\n\t\tconsole.log(\"Can't receive \\\"Last-Modified\\\" header from server\")\r\n\t\treturn false\r\n\treturn lastModified\r\n\r\nwindow.StyleSheetReloader.runByTagParams()","\n/**\n * StyleSheetReloader v 1.5\n * Author: Vlad Tokarev <vlad@tokarev.tk>\n */\n\n(function() {\n  var hasProp = {}.hasOwnProperty;\n\n  window.StyleSheetReloader = function(options) {\n    var hotKeyPressed;\n    options = window.StyleSheetReloader.prepareOptions(options);\n    hotKeyPressed = function(hotKey, event) {\n      var i, key, len, result;\n      hotKey = hotKey.split('+');\n      result = true;\n      for (i = 0, len = hotKey.length; i < len; i++) {\n        key = hotKey[i];\n        if (key.trim().length) {\n          key = key.trim().toLowerCase();\n          if (key === 'alt' || key === 'ctrl' || key === 'shift') {\n            if (!event[key + 'Key']) {\n              return false;\n            }\n          } else {\n            if (event.keyCode !== key.toUpperCase().charCodeAt(0)) {\n              return false;\n            }\n          }\n        }\n      }\n      return result;\n    };\n    return document.addEventListener('keydown', function(e) {\n      if (hotKeyPressed(options.hotKey, e)) {\n        return window.StyleSheetReloader.reload(options.cssUrl);\n      }\n    });\n  };\n\n  window.StyleSheetReloader.prepareOptions = function(options, parseJson) {\n    var defaultOptions, error, json, optionDefaultValue, optionKey;\n    if (options == null) {\n      options = false;\n    }\n    if (parseJson == null) {\n      parseJson = false;\n    }\n    defaultOptions = {\n      cssUrl: false,\n      hotKey: 'alt+r'\n    };\n    if (parseJson && options && options.length) {\n      try {\n        json = JSON.parse(options);\n        options = json;\n      } catch (_error) {\n        error = _error;\n        console.log(error);\n      }\n    }\n    if (typeof options === 'string') {\n      options = {\n        cssUrl: options\n      };\n    }\n    if (typeof options !== 'object') {\n      options = {};\n    }\n    for (optionKey in defaultOptions) {\n      if (!hasProp.call(defaultOptions, optionKey)) continue;\n      optionDefaultValue = defaultOptions[optionKey];\n      if (!options[optionKey]) {\n        options[optionKey] = defaultOptions[optionKey];\n      }\n    }\n    if (options.cssUrl && !options.cssUrl.length) {\n      options.cssUrl = false;\n    }\n    return options;\n  };\n\n  window.StyleSheetReloader.reload = function(cssUrl) {\n    var addParameter, href, hrefLastChar, i, len, link, links, replacedLinks, replacedVersion;\n    if (cssUrl == null) {\n      cssUrl = false;\n    }\n    replacedLinks = 0;\n    if (typeof cssUrl === 'string' && !cssUrl.length) {\n      cssUrl = false;\n    }\n    links = document.querySelectorAll('link[rel=stylesheet][href]');\n    for (i = 0, len = links.length; i < len; i++) {\n      link = links[i];\n      href = link.getAttribute('href');\n      if (href && href.length && (!cssUrl || href.indexOf(cssUrl) !== -1)) {\n        href = href.split('replacedVersion')[0];\n        hrefLastChar = href.substr(href.length - 1);\n        if (hrefLastChar === '?' || hrefLastChar === '&') {\n          href = href.substr(0, href.length - 1);\n        }\n        replacedVersion = Date.now();\n        addParameter = '?';\n        if (href.indexOf('?') !== -1) {\n          addParameter = '&';\n        }\n        href += addParameter + 'replacedVersion=' + replacedVersion;\n        link.setAttribute('href', href);\n        replacedLinks++;\n      }\n    }\n    return replacedLinks;\n  };\n\n  window.StyleSheetReloader.runByTagParams = function() {\n    var i, len, options, results, script, scripts;\n    scripts = document.querySelectorAll('script[data-stylesheetReloader]');\n    results = [];\n    for (i = 0, len = scripts.length; i < len; i++) {\n      script = scripts[i];\n      options = window.StyleSheetReloader.prepareOptions(script.getAttribute('data-stylesheetReloader'), true);\n      results.push(window.StyleSheetReloader(options));\n    }\n    return results;\n  };\n\n  window.StyleSheetReloader.listen = function(url, period) {\n    var href, i, len, link, links, reloadIfRequired, urlString;\n    if (url == null) {\n      url = false;\n    }\n    if (period == null) {\n      period = 1000;\n    }\n    if (typeof url === 'string' && !url.length) {\n      url = false;\n    }\n    if (!url) {\n      url = {};\n      links = document.querySelectorAll('link[rel=stylesheet][href]');\n      for (i = 0, len = links.length; i < len; i++) {\n        link = links[i];\n        href = link.getAttribute('href');\n        if (href && href.length) {\n          url[href] = 0;\n        }\n      }\n    }\n    if (typeof url === 'string') {\n      urlString = url;\n      url = {};\n      url[urlString] = 0;\n    }\n    reloadIfRequired = function() {\n      var lm, results, urlLastMod, urlLink;\n      results = [];\n      for (urlLink in url) {\n        if (!hasProp.call(url, urlLink)) continue;\n        urlLastMod = url[urlLink];\n        lm = window.StyleSheetReloader.getLastModificationTime(urlLink);\n        if (urlLastMod !== lm) {\n          url[urlLink] = lm;\n          results.push(window.StyleSheetReloader.reload(urlLink));\n        } else {\n          results.push(void 0);\n        }\n      }\n      return results;\n    };\n    setInterval(reloadIfRequired, period);\n    return period;\n  };\n\n  window.StyleSheetReloader.getLastModificationTime = function(url) {\n    var error, lastModified, request;\n    request = new XMLHttpRequest();\n    try {\n      request.open('HEAD', url, false);\n      request.send(null);\n    } catch (_error) {\n      error = _error;\n      console.log(error);\n      return false;\n    }\n    if (request.readyState < 3) {\n      console.log(\"Server doesn't ready to answer\");\n      return false;\n    }\n    if (!request) {\n      console.log(\"XMLHttpRequest doesn't supported by your browser\");\n      return false;\n    }\n    lastModified = request.getResponseHeader('Last-Modified');\n    if (!lastModified) {\n      console.log(\"Can't receive \\\"Last-Modified\\\" header from server\");\n      return false;\n    }\n    return lastModified;\n  };\n\n  window.StyleSheetReloader.runByTagParams();\n\n}).call(this);\n"],"sourceRoot":"/source/"}